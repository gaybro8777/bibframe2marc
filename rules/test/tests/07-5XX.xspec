<?xml version="1.0" encoding="UTF-8"?>

<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:marc="http://www.loc.gov/MARC21/slim"
               stylesheet="../../../bibframe2marc.xsl"
               xslt-version="1.0">

  <!-- To run this test file separately, uncomment the lines below -->
  <!-- <x:param name="vCurrentVersion">0.1.0-TEST</x:param> -->
  <!-- <x:param name="pGenerationDatestamp">NOW</x:param> -->

  <!-- I know, a 490 isn't a 5XX -->
  <x:scenario label="MARC 490">
    <x:context href="../data/5XX/490.xml"/>
    <x:expect label="generate 490"
              test="count(//marc:datafield[@tag='490']) = 1"/>
    <x:expect label="ind1 default to '0'"
              test="//marc:datafield[@tag='490']/@ind1 = '0'"/>
    <x:expect label="ind2 default to blank"
              test="//marc:datafield[@tag='490']/@ind2 = ' '"/>
    <x:expect label="$a from seriesStatement"
              test="//marc:datafield[@tag='490']/marc:subfield[@code='a'][1] = 'A series of unfortunate events'"/>
    <x:expect label="$v from seriesEnumeration"
              test="//marc:datafield[@tag='490']/marc:subfield[@code='v'][2] = 'no 14'"/>
  </x:scenario>

  <x:scenario label="Default MARC field 500">
    <x:context href="../data/regression/bibframe.xml"/>
    <x:expect label="...all records should have the default 500 field"
              test="count(marc:record/marc:datafield[@tag='500']/marc:subfield[@code='a'][contains(text(),'MARC record generated by DLC bibframe2marc')]) = 1"/>
    <x:expect label="...with the version"
              test="contains(marc:record/marc:datafield[@tag='500']/marc:subfield[@code='a'][contains(text(),'MARC record generated by DLC bibframe2marc')],'0.1.0-TEST')"/>
    <x:expect label="...and the datestamp"
              test="contains(marc:record/marc:datafield[@tag='500']/marc:subfield[@code='a'][contains(text(),'MARC record generated by DLC bibframe2marc')],': NOW')"/>
  </x:scenario>

  <x:scenario label="MARC 500">
    <x:context href="../data/5XX/500.xml"/>
    <x:expect label="generate 500" test="count(//marc:datafield[@tag='500']) = 2"/>
  </x:scenario>

  <x:scenario label="MARC 505">
    <x:context href="../data/5XX/505.xml"/>
    <x:expect label="generate 505 from bf:tableOfContents property"
              test="count(//marc:datafield[@tag='505']) = 1"/>
  </x:scenario>

  <x:scenario label="MARC 507">
    <x:context href="../data/5XX/507.xml"/>
    <x:expect label="generate 507 from scale property on Instance" test="count(//marc:datafield[@tag='507']) = 2"/>
    <x:expect label="$a from scale literal" test="//marc:datafield[@tag='507'][1]/marc:subfield[@code='a'] = 'Scale 1:10 of the original'"/>
    <x:expect label="...or from bf:Scale object" test="//marc:datafield[@tag='507'][2]/marc:subfield[@code='a'] = 'Scale 1:500,000; 1 in. equals 8 miles.'"/>
  </x:scenario>

  <x:scenario label="MARC 511">
    <x:context href="../data/5XX/511.xml"/>
    <x:expect label="generate 511 from bf:credits property with 'Cast:' display constant"
              test="//marc:datafield[@tag='511']/marc:subfield[@code='a'] = 'Maggie Smith, Dame Judi Dench, Tom Wilkinson, Bill Nighy.'"/>
  </x:scenario>

  <x:scenario label="MARC 520">
    <x:context href="../data/5XX/520.xml"/>
    <x:expect label="generate 520 from bf:summary property"
              test="//marc:datafield[@tag='520']/marc:subfield[@code='a'] = 'Following the yearly tradition, this release will feature an array of Grammy-nominated artists. The bestselling collection includes categories representing nominees for Record of the Year, Album of the Year, Song of the Year, and more.'"/>
  </x:scenario>

  <x:scenario label="MARC 525">
    <x:context href="../data/5XX/525.xml"/>
    <x:expect label="generate 525" test="count(//marc:datafield[@tag='525']) = 1"/>
  </x:scenario>

  <x:scenario label="MARC 538">
    <x:context href="../data/5XX/538.xml"/>
    <x:expect label="generate 538 from bf:systemRequirement property"
              test="//marc:datafield[@tag='538']/marc:subfield[@code='a'] = 'Blu-ray disc; requires Blu-ray player.'"/>
  </x:scenario>

</x:description>
