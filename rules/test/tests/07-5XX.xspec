<?xml version="1.0" encoding="UTF-8"?>

<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:marc="http://www.loc.gov/MARC21/slim"
               stylesheet="../../../bibframe2marc.xsl"
               xslt-version="1.0">

  <!-- To run this test file separately, uncomment the lines below -->
  <!-- <x:param name="vCurrentVersion">0.1.0-TEST</x:param> -->
  <!-- <x:param name="pGenerationDatestamp">NOW</x:param> -->

  <x:scenario label="Default MARC field 500">
    <x:context href="../data/regression/bibframe.xml"/>
    <x:expect label="...all records should have the default 500 field"
              test="count(marc:record/marc:datafield[@tag='500']/marc:subfield[@code='a'][contains(text(),'MARC record generated by DLC bibframe2marc')]) = 1"/>
    <x:expect label="...with the version"
              test="contains(marc:record/marc:datafield[@tag='500']/marc:subfield[@code='a'][contains(text(),'MARC record generated by DLC bibframe2marc')],'0.1.0-TEST')"/>
    <x:expect label="...and the datestamp"
              test="contains(marc:record/marc:datafield[@tag='500']/marc:subfield[@code='a'][contains(text(),'MARC record generated by DLC bibframe2marc')],': NOW')"/>
  </x:scenario>

  <x:scenario label="MARC 500">
    <x:context href="../data/5XX/500.xml"/>
    <x:expect label="generate 500" test="count(//marc:datafield[@tag='500']) = 2"/>
  </x:scenario>

  <x:scenario label="MARC 505">
    <x:context href="../data/5XX/505.xml"/>
    <x:expect label="generate 505 from bf:tableOfContents property"
              test="count(//marc:datafield[@tag='505']) = 1"/>
  </x:scenario>

  <x:scenario label="MARC 507">
    <x:context href="../data/5XX/507.xml"/>
    <x:expect label="generate 507 from scale property on Instance" test="count(//marc:datafield[@tag='507']) = 2"/>
    <x:expect label="$a from scale literal" test="//marc:datafield[@tag='507'][1]/marc:subfield[@code='a'] = 'Scale 1:10 of the original'"/>
    <x:expect label="...or from bf:Scale object" test="//marc:datafield[@tag='507'][2]/marc:subfield[@code='a'] = 'Scale 1:500,000; 1 in. equals 8 miles.'"/>
  </x:scenario>

  <x:scenario label="MARC 511">
    <x:context href="../data/5XX/511.xml"/>
    <x:expect label="generate 511 from bf:credits property with 'Cast:' display constant"
              test="//marc:datafield[@tag='511']/marc:subfield[@code='a'] = 'Maggie Smith, Dame Judi Dench, Tom Wilkinson, Bill Nighy.'"/>
  </x:scenario>

  <x:scenario label="MARC 525">
    <x:context href="../data/5XX/525.xml"/>
    <x:expect label="generate 525" test="count(//marc:datafield[@tag='525']) = 1"/>
  </x:scenario>

</x:description>
