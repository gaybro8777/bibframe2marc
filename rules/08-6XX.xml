<?xml version='1.0'?>
<rules xmlns="http://www.loc.gov/bf2marc"
       xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
       xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
       xmlns:bf="http://id.loc.gov/ontologies/bibframe/"
       xmlns:bflc="http://id.loc.gov/ontologies/bflc/"
       xmlns:madsrdf="http://www.loc.gov/mads/rdf/v1#"
       xmlns:marc="http://www.loc.gov/MARC21/slim"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <df tag="600">
    <context xpath="bf:Work/bf:subject/*[local-name()='PersonalName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#PersonalName'] or local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName'] or local-name()='Person' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Person']] |
                    bf:Work/bf:subject/bf:Work/bf:contribution/*/bf:agent/*[local-name()='PersonalName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#PersonalName'] or local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName'] or local-name()='Person' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Person']]">
      <ind1 default="1">
        <switch>
          <case test="local-name()='FamilyName'">3</case>
        </switch>
      </ind1>
      <ind2 default="4">
        <switch>
          <case test="bf:source/bf:Source/bf:code='lcsh' or ancestor::bf:subject/bf:Work/bf:source/bf:Source/bf:code='lcsh'">0</case>
          <case test="bf:source/bf:Source/bf:code='lcshac' or ancestor::bf:subject/bf:Work/bf:source/bf:Source/bf:code='lcshac'">1</case>
          <case test="bf:source/bf:Source/bf:code='mesh' or ancestor::bf:subject/bf:Work/bf:source/bf:Source/bf:code='mesh'">2</case>
          <case test="bf:source/bf:Source/bf:code='nal' or ancestor::bf:subject/bf:Work/bf:source/bf:Source/bf:code='nal'">3</case>
          <case test="bf:source/bf:Source/bf:code='cash' or ancestor::bf:subject/bf:Work/bf:source/bf:Source/bf:code='cash'">5</case>
          <case test="bf:source/bf:Source/bf:code='rvm' or ancestor::bf:subject/bf:Work/bf:source/bf:Source/bf:code='rvm'">6</case>
          <case test="bf:source/bf:Source/bf:code or ancestor::bf:subject/bf:Work/bf:source/bf:Source/bf:code">7</case>
        </switch>
      </ind2>
      <sf code="a" repeatable="false">
        <switch>
          <case test="madsrdf:elementList/madsrdf:FullNameElement/madsrdf:elementValue">
            <select xpath="madsrdf:elementList/madsrdf:FullNameElement/madsrdf:elementValue[1]"/>
          </case>
          <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
          <case test="default"><select xpath="rdfs:label"/></case>
        </switch>
      </sf>
      <sf code="c">
        <select xpath="madsrdf:elementList/madsrdf:TermsOfAddressNameElement/madsrdf:elementValue"/>
      </sf>
      <sf code="d" repeatable="false">
        <select xpath="madsrdf:elementList/madsrdf:DateNameElement/madsrdf:elementValue"/>
      </sf>
      <sf code="e">
        <select xpath="bf:role/bf:Role/rdfs:label"/>
      </sf>
      <sf code="q" repeatable="false"><select xpath="madsrdf:fullerName/*/rdfs:label"/></sf>
      <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
      <sf code="0">
        <select xpath="bf:identifiedBy/bf:Identifier">
          <transform>
            <xsl:variable name="vIdType" select="rdfs:label"/>
            <xsl:choose>
              <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
              <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
            </xsl:choose>
          </transform>
        </select>
      </sf>
      <select xpath="ancestor::bf:subject/bf:Work/bf:title/bf:Title[1]">
        <sf code="t" repeatable="false"><select xpath="rdfs:label"/></sf>
        <sf code="f" repeatable="false"><select xpath="../../bf:originDate"/></sf>
        <sf code="k"><select xpath="../../bf:natureOfContent"/></sf>
        <!-- language is going to be a problem -->
        <sf code="l" repeatable="false">
          <select xpath="../../bf:language/*/rdfs:label|../../bf:language/*/madsrdf:authoritativeLabel"/>
        </sf>
        <sf code="m"><select xpath="../../bf:musicMedium/bf:MusicMedium/rdfs:label"/></sf>
        <sf code="n"><select xpath="bf:partNumber"/></sf>
        <sf code="p"><select xpath="bf:partName"/></sf>
        <sf code="r" repeatable="false"><select xpath="../../bf:musicKey"/></sf>
        <sf code="s"><select xpath="../../bf:version"/></sf>
        <sf code="0"><select xpath="../../@rdf:about[not(contains(.,'example.org'))]"/></sf>
        <sf code="0">
          <select xpath="../../bf:identifiedBy/bf:Identifier">
            <transform>
              <xsl:variable name="vIdType" select="rdfs:label"/>
              <xsl:choose>
                <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
              </xsl:choose>
            </transform>
          </select>
        </sf>
      </select>
      <select xpath="madsrdf:componentList/*">
        <switch>
          <case test="local-name()='Topic' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Topic'] or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Topic']">
            <sf code="x"><select xpath="madsrdf:authoritativeLabel|rdfs:label"/></sf>
            <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
          </case>
          <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
            <sf code="v"><select xpath="madsrdf:authoritativeLabel|rdfs:label"/></sf>
            <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
          </case>
          <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
            <sf code="y"><select xpath="madsrdf:authoritativeLabel"/></sf>
            <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
          </case>
          <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
            <sf code="z"><select xpath="madsrdf:authoritativeLabel"/></sf>
            <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
          </case>
        </switch>
      </select>
    </context>
  </df>

  <df tag="650">
    <context xpath="bf:Work/bf:subject/*[local-name()='Topic' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Topic'] or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Topic']]">
      <ind1 default=" "/>
      <ind2 default="4">
        <switch>
          <case test="bf:source/bf:Source/bf:code='lcsh'">0</case>
          <case test="bf:source/bf:Source/bf:code='lcshac'">1</case>
          <case test="bf:source/bf:Source/bf:code='mesh'">2</case>
          <case test="bf:source/bf:Source/bf:code='nal'">3</case>
          <case test="bf:source/bf:Source/bf:code='cash'">5</case>
          <case test="bf:source/bf:Source/bf:code='rvm'">6</case>
          <case test="bf:source/bf:Source/bf:code">7</case>
          <case test="contains(@rdf:about,'id.loc.gov/authorities/subjects') or contains(madsrdf:componentList/*[local-name()='Topic' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Topic'] or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Topic']][1]/@rdf:about,'id.loc.gov/authorities/subjects')">0</case>
          <case test="contains(@rdf:about,'id.loc.gov/authorities/childrensSubjects') or contains(madsrdf:componentList/*[local-name()='Topic' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Topic'] or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Topic']][1]/@rdf:about,'id.loc.gov/authorities/childrensSubjects')">1</case>
        </switch>
      </ind2>
      <sf code="3" repeatable="false">
        <select xpath="bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
      </sf>
      <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
      <switch>
        <case test="madsrdf:componentList">
          <sf code="a" repeatable="false">
            <select xpath="madsrdf:componentList/*[local-name()='Topic' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Topic'] or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Topic']][1]/*[local-name()='authoritativeLabel' or local-name()='label'][1]"/>
          </sf>
          <sf code="0"><select xpath="madsrdf:componentList/*[local-name()='Topic' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Topic'] or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Topic']][1]/@rdf:about[not(contains(.,'example.org'))]"/></sf>
          <select xpath="madsrdf:componentList/*">
            <switch>
              <case test="local-name()='Topic' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Topic'] or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Topic']">
                <switch>
                  <case test="generate-id(.) != generate-id(../*[local-name()='Topic' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Topic'] or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Topic']][1])">
                    <sf code="x"><select xpath="madsrdf:authoritativeLabel|rdfs:label"/></sf>
                    <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  </case>
                </switch>
              </case>
              <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                <sf code="v"><select xpath="madsrdf:authoritativeLabel|rdfs:label"/></sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
              </case>
              <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                <sf code="y"><select xpath="madsrdf:authoritativeLabel"/></sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
              </case>
              <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                <sf code="z"><select xpath="madsrdf:authoritativeLabel"/></sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
              </case>
            </switch>
          </select>
        </case>
        <case test="default">
          <sf code="a" repeatable="false">
            <switch>
              <case test="madsrdf:authoritativeLabel">
                <select xpath="madsrdf:authoritativeLabel[1]"/>
              </case>
              <case test="default"><select xpath="rdfs:label[1]"/></case>
            </switch>
          </sf>
        </case>
      </switch>
      <sf code="e">
        <select xpath="bflc:relationship/bflc:Relationship/bflc:relation/bflc:Relation/rdfs:label"/>
      </sf>
      <sf code="2"><select xpath="bf:source/bf:Source/bf:code"/></sf>
    </context>
  </df>

</rules>
