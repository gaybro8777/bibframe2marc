<?xml version='1.0'?>
<rules xmlns="http://www.loc.gov/bf2marc"
       xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
       xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
       xmlns:bf="http://id.loc.gov/ontologies/bibframe/"
       xmlns:bflc="http://id.loc.gov/ontologies/bflc/"
       xmlns:madsrdf="http://www.loc.gov/mads/rdf/v1#"
       xmlns:marc="http://www.loc.gov/MARC21/slim"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <df tag="300">
    <context xpath="bf:Instance/bf:extent/bf:Extent">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="3" repeatable="false">
        <select xpath="bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
      </sf>
      <sf code="a"><select xpath="rdfs:label"/></sf>
      <sf code="b" repeatable="false">
        <select xpath="../../bf:note/bf:Note[bf:noteType='Physical details']/rdfs:label"/>
      </sf>
      <sf code="c"><select xpath="../../bf:dimensions"/></sf>
      <sf code="e" repeatable="false">
        <select xpath="../../bf:note/bf:Note[bf:noteType='Accompanying material']/rdfs:label"/>
      </sf>
    </context>
  </df>

  <switch>
    <case test="bf:Instance/bf:duration">
      <df tag="306" repeatable="false">
        <ind1 default=" "/>
        <ind2 default=" "/>
        <sf code="a">
          <select xpath="bf:Instance/bf:duration"/>
        </sf>
      </df>
    </case>
  </switch>

  <select xpath="bf:Instance/bf:frequency/bf:Frequency">
    <switch>
      <case test="position() = 1">
        <df tag="310">
          <ind1 default=" "/>
          <ind2 default=" "/>
          <sf code="a" repeatable="false">
            <select xpath="rdfs:label"/>
          </sf>
          <sf code="b" repeatable="false">
            <select xpath="bf:date"/>
          </sf>
        </df>
      </case>
      <case test="default">
        <df tag="321">
          <ind1 default=" "/>
          <ind2 default=" "/>
          <sf code="a" repeatable="false">
            <select xpath="rdfs:label"/>
          </sf>
          <sf code="b" repeatable="false">
            <select xpath="bf:date"/>
          </sf>
        </df>
      </case>
    </switch>
  </select>

  <df tag="336">
    <context xpath="bf:Work/bf:content/*[local-name()='Content' or
                                                 rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Content'] or
                                                 local-name()='Authority' or
                                                 rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Authority']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="3" repeatable="false">
        <select xpath="bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
      </sf>
      <sf code="a">
        <switch>
          <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
          <case test="default"><select xpath="rdfs:label"/></case>
        </switch>
      </sf>
      <sf code="b" repeatable="false">
        <select xpath="madsrdf:code"/>
      </sf>
      <sf code="0">
        <select xpath="@rdf:about"/>
      </sf>
      <sf code="0">
        <select xpath="bf:identifiedBy/bf:Identifier">
          <transform>
            <xsl:variable name="vSource">
              <xsl:value-of select="bf:source/bf:Source/rdfs:label"/>
            </xsl:variable>
            <xsl:choose>
              <xsl:when test="$vSource != ''">
                <xsl:value-of select="concat('(',$vSource,')',rdf:value)"/>
              </xsl:when>
              <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
            </xsl:choose>
          </transform>
        </select>
      </sf>
      <sf code="2" repeatable="false">
        <select xpath="bf:source/bf:Source/rdfs:label"/>
      </sf>
    </context>
  </df>

  <df tag="337">
    <context xpath="bf:Instance/bf:media/*[local-name()='Media' or
                                                   rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Media'] or
                                                   local-name()='Authority' or
                                                   rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Authority']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="3" repeatable="false">
        <select xpath="bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
      </sf>
      <sf code="a">
        <switch>
          <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
          <case test="default"><select xpath="rdfs:label"/></case>
        </switch>
      </sf>
      <sf code="b" repeatable="false">
        <select xpath="madsrdf:code"/>
      </sf>
      <sf code="0">
        <select xpath="@rdf:about"/>
      </sf>
      <sf code="0">
        <select xpath="bf:identifiedBy/bf:Identifier">
          <transform>
            <xsl:variable name="vSource">
              <xsl:value-of select="bf:source/bf:Source/rdfs:label"/>
            </xsl:variable>
            <xsl:choose>
              <xsl:when test="$vSource != ''">
                <xsl:value-of select="concat('(',$vSource,')',rdf:value)"/>
              </xsl:when>
              <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
            </xsl:choose>
          </transform>
        </select>
      </sf>
      <sf code="2" repeatable="false">
        <select xpath="bf:source/bf:Source/rdfs:label"/>
      </sf>
    </context>
  </df>

  <df tag="338">
    <context xpath="bf:Instance/bf:carrier/*[local-name()='Carrier' or
                                                     rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Carrier'] or
                                                     local-name()='Authority' or
                                                     rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Authority']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="3" repeatable="false">
        <select xpath="bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
      </sf>
      <sf code="a">
        <switch>
          <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
          <case test="default"><select xpath="rdfs:label"/></case>
        </switch>
      </sf>
      <sf code="b" repeatable="false">
        <select xpath="madsrdf:code"/>
      </sf>
      <sf code="0">
        <select xpath="@rdf:about"/>
      </sf>
      <sf code="0">
        <select xpath="bf:identifiedBy/bf:Identifier">
          <transform>
            <xsl:variable name="vSource">
              <xsl:value-of select="bf:source/bf:Source/rdfs:label"/>
            </xsl:variable>
            <xsl:choose>
              <xsl:when test="$vSource != ''">
                <xsl:value-of select="concat('(',$vSource,')',rdf:value)"/>
              </xsl:when>
              <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
            </xsl:choose>
          </transform>
        </select>
      </sf>
      <sf code="2" repeatable="false">
        <select xpath="bf:source/bf:Source/rdfs:label"/>
      </sf>
    </context>
  </df>

  <df tag="340">
    <context xpath="bf:Instance/bf:baseMaterial/bf:BaseMaterial |
                    bf:Instance/bf:appliedMaterial/bf:AppliedMaterial |
                    bf:Instance/bf:productionMethod/bf:ProductionMethod |
                    bf:Instance/bf:mount/bf:Mount |
                    bf:Instance/bf:reductionRatio/bf:ReductionRatio |
                    bf:Work/bf:colorContent/bf:ColorContent |
                    bf:Instance/bf:systemRequirement |
                    bf:Instance/bf:generation/bf:Generation |
                    bf:Instance/bf:layout/bf:Layout |
                    bf:Instance/bf:bookFormat/bf:BookFormat |
                    bf:Instance/bf:fontSize/bf:FontSize |
                    bf:Instance/bf:polarity/bf:Polarity">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="local-name()='BaseMaterial'">
          <sf code="a"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='AppliedMaterial'">
          <sf code="c"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='ProductionMethod'">
          <sf code="d"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='Mount'">
          <sf code="e"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='reductionRatio'">
          <sf code="f"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='ColorContent'">
          <sf code="g"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='systemRequirement'">
          <sf code="i"><select xpath="."/></sf>
        </case>
        <case test="local-name()='Generation'">
          <sf code="j"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='Layout'">
          <sf code="k"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='BookFormat'">
          <sf code="m"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='FontSize'">
          <sf code="n"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='Polarity'">
          <sf code="o"><select xpath="rdfs:label"/></sf>
        </case>
      </switch>
      <sf code="0">
        <select xpath="@rdf:about"/>
      </sf>
      <sf code="0">
        <select xpath="bf:identifiedBy/bf:Identifier">
          <transform>
            <xsl:variable name="vSource">
              <xsl:value-of select="bf:source/bf:Source/rdfs:label"/>
            </xsl:variable>
            <xsl:choose>
              <xsl:when test="$vSource != ''">
                <xsl:value-of select="concat('(',$vSource,')',rdf:value)"/>
              </xsl:when>
              <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
            </xsl:choose>
          </transform>
        </select>
      </sf>
      <sf code="2" repeatable="false">
        <select xpath="bf:source/bf:Source/rdfs:label"/>
      </sf>
    </context>
  </df>

  <df tag="344">
    <context xpath="bf:Instance/bf:soundCharacteristic/bf:RecordingMethod |
                    bf:Instance/bf:soundCharacteristic/bf:RecordingMedium |
                    bf:Instance/bf:soundCharacteristic/bf:PlayingSpeed |
                    bf:Instance/bf:soundCharacteristic/bf:GrooveCharacteristics |
                    bf:Instance/bf:soundCharacteristic/bf:TrackConfig |
                    bf:Instance/bf:soundCharacteristic/bf:TapeConfig |
                    bf:Instance/bf:soundCharacteristic/bf:PlaybackChannels |
                    bf:Instance/bf:soundCharacteristic/bf:PlaybackCharacteristic">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="3" repeatable="false">
        <select xpath="bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
      </sf>
      <switch>
        <case test="local-name()='RecordingMethod'">
          <sf code="a"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='RecordingMedium'">
          <sf code="b"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='PlayingSpeed'">
          <sf code="c"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='GrooveCharacteristics'">
          <sf code="d"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='TrackConfig'">
          <sf code="e"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='TapeConfig'">
          <sf code="f"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='PlaybackChannels'">
          <sf code="g"><select xpath="rdfs:label"/></sf>
        </case>
        <case test="local-name()='PlaybackCharacteristic'">
          <sf code="h"><select xpath="rdfs:label"/></sf>
        </case>
      </switch>
      <sf code="0">
        <select xpath="@rdf:about"/>
      </sf>
      <sf code="0">
        <select xpath="bf:identifiedBy/bf:Identifier">
          <transform>
            <xsl:variable name="vSource">
              <xsl:value-of select="bf:source/bf:Source/rdfs:label"/>
            </xsl:variable>
            <xsl:choose>
              <xsl:when test="$vSource != ''">
                <xsl:value-of select="concat('(',$vSource,')',rdf:value)"/>
              </xsl:when>
              <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
            </xsl:choose>
          </transform>
        </select>
      </sf>
      <sf code="2" repeatable="false">
        <select xpath="bf:source/bf:Source/rdfs:label"/>
      </sf>
    </context>
  </df>

</rules>
