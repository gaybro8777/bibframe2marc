<?xml version='1.0'?>
<rules xmlns="http://www.loc.gov/bf2marc"
       xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
       xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
       xmlns:bf="http://id.loc.gov/ontologies/bibframe/"
       xmlns:bflc="http://id.loc.gov/ontologies/bflc/"
       xmlns:madsrdf="http://www.loc.gov/mads/rdf/v1#"
       xmlns:marc="http://www.loc.gov/MARC21/slim"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <df tag="010" repeatable="false">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[
        (local-name()='Lccn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Lccn']) and
        not(
          bf:status/bf:Status/rdfs:label[text()='invalid'] or
          bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
          bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'
        )]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="a" repeatable="false">
        <select xpath="rdf:value"/>
      </sf>
      <sf code="z">
        <select xpath="ancestor::bf:Instance/bf:identifiedBy/*[
            (local-name()='Lccn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Lccn']) and
            (
              bf:status/bf:Status/rdfs:label[text()='invalid'] or
              bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
              bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'
            )]/rdf:value"/>
      </sf>
    </context>
  </df>

  <df tag="015">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Nbn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Nbn']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
      <sf code="2" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
    </context>
  </df>

  <df tag="016">
    <context xpath="rdf:RDF/bf:Work/bf:adminMetadata/bf:AdminMetadata/bf:identifiedBy/bf:Local[
                      bf:source/bf:Source and
                      not(bf:source/bf:Source/rdfs:label='DLC')
                    ]">
      <ind1 default="7">
        <switch>
          <case test="bf:source/bf:Source/rdfs:label='OONL' or
                      bf:source/bf:Source/rdfs:label='Library and Archives Canada'"><text> </text></case>
        </switch>
      </ind1>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
      <sf code="2" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
    </context>
  </df>

  <df tag="017">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='CopyrightNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/CopyrightNumber']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
      <sf code="b" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
      <sf code="d" repeatable="false"><select xpath="bf:date"/></sf>
      <sf code="i" repeatable="false"><select xpath="bf:note/bf:Note/rdfs:label"/></sf>
    </context>
  </df>

  <df tag="020">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Isbn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Isbn']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
          <sf code="c" repeatable="false"><select xpath="ancestor::bf:Instance/bf:acquisitionTerms"/></sf>
        </case>
      </switch>
      <sf code="q"><select xpath="bf:qualifier"/></sf>
    </context>
  </df>

  <df tag="022">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Issn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Issn']] | rdf:RDF/bf:Work/bf:identifiedBy/*[local-name()='IssnL' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/IssnL']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='canceled'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <switch>
            <case test="local-name()='Issn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Issn']">
              <sf code="z"><select xpath="rdf:value"/></sf>
            </case>
            <case test="local-name()='IssnL' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/IssnL']">
              <sf code="m"><select xpath="rdf:value"/></sf>
            </case>
          </switch>
        </case>
        <case test="bf:status/bf:Status/rdfs:label[text()='incorrect'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/incorrect' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/incorrect'">
          <sf code="y"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <switch>
            <case test="local-name()='Issn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Issn']">
              <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
            </case>
            <case test="local-name()='IssnL' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/IssnL']">
              <sf code="l" repeatable="false"><select xpath="rdf:value"/></sf>
            </case>
          </switch>
        </case>
      </switch>
      <sf code="2" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
    </context>
  </df>

  <df tag="024">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Isrc' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Isrc']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Upc' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Upc']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Ismn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Ismn']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Ean' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Ean']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Sici' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Sici']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Ansi' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Ansi']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Doi' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Doi']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Hdl' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Hdl']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Isan' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Isan']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Isni' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Isni']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Iso' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Iso']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Istc' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Istc']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Iswc' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Iswc']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='MatrixNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MatrixNumber']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='MusicPlate' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicPlate']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='MusicPublisherNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicPublisherNumber']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='StockNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/StockNumber']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Urn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Urn']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='VideoRecordingNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/VideoRecordingNumber']] |
      rdf:RDF/bf:Instance/bf:identifiedBy/bf:Identifier[not(rdf:type)]">
      <ind1 default="7">
        <switch>
          <case test="local-name()='Isrc' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Isrc']">0</case>
          <case test="local-name()='Upc' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Upc']">1</case>
          <case test="local-name()='Ismn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Ismn']">2</case>
          <case test="local-name()='Ean' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Ean']">3</case>
          <case test="local-name()='Sici' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Sici']">4</case>
          <case test="local-name()='Identifier' and not(rdf:type) and not(rdfs:label)">8</case>
        </switch>
      </ind1>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
      <sf code="q"><select xpath="bf:qualifier"/></sf>
      <sf code="2">
        <switch>
          <case test="local-name()='Ansi' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Ansi']">ansi</case>
          <case test="local-name()='Doi' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Doi']">doi</case>
          <case test="local-name()='Hdl' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Hdl']">hdl</case>
          <case test="local-name()='Isan' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Isan']">isan</case>
          <case test="local-name()='Isni' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Isni']">isni</case>
          <case test="local-name()='Iso' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Iso']">iso</case>
          <case test="local-name()='Istc' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Istc']">istc</case>
          <case test="local-name()='Iswc' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Iswc']">iswc</case>
          <case test="local-name()='MatrixNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MatrixNumber']">matrix-number</case>
          <case test="local-name()='MusicPlate' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicPlate']">music-plate</case>
          <case test="local-name()='MusicPublisherNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicPublisherNumber']">music-publisher</case>
          <case test="local-name()='StockNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/StockNumber']">stock-number</case>
          <case test="local-name()='Urn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Urn']">urn</case>
          <case test="local-name()='VideoRecordingNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/VideoRecordingNumber']">video-recording-identifier</case>
          <case test="default"><select xpath="rdfs:label"/></case>
        </switch>
      </sf>
    </context>
  </df>

  <df tag="025">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='LcOverseasAcq' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/LcOverseasAcq']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="a"><select xpath="rdf:value"/></sf>
    </context>
  </df>

  <df tag="026">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Fingerprint' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Fingerprint']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="e" repeatable="false"><select xpath="rdf:value"/></sf>
      <sf code="2" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
      <sf code="5">
        <select xpath="bflc:applicableInstitution/bf:Agent/bf:code"/>
      </sf>
    </context>
  </df>

  <df tag="027">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Strn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Strn']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
      <sf code="q"><select xpath="bf:qualifier"/></sf>
    </context>
  </df>

  <df tag="028">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='AudioIssueNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/AudioIssueNumber']] |
                    rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='MatrixNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MatrixNumber']] |
                    rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='MusicPlate' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicPlate']] |
                    rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='MusicPublishingNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicPublishingNumber']] |
                    rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='VideoRecordingNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/VideoRecordingNumber']] |
                    rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='PublisherNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/PublisherNumber']] |
                    rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='MusicDistributorNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicDistributorNumber']]">
      <ind1 default="5">
        <switch>
          <case test="local-name()='AudioIssueNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/AudioIssueNumber']">0</case>
          <case test="local-name()='MatrixNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MatrixNumber']">1</case>
          <case test="local-name()='MusicPlate' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicPlate']">2</case>
          <case test="local-name()='MusicPublishingNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicPublishingNumber']">3</case>
          <case test="local-name()='VideoRecordingNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/VideoRecordingNumber']">4</case>
          <case test="local-name()='MusicDistributorNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MusicDistributorNumber']">6</case>
        </switch>
      </ind1>
      <ind2 default="2"/>
      <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
      <sf code="b" repeatable="false"><select xpath="bf:source/bf:Source/rdf:value"/></sf>
      <sf code="q"><select xpath="bf:qualifier"/></sf>
    </context>
  </df>

  <df tag="030">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Coden' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Coden']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
    </context>
  </df>

  <df tag="032">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='PostalRegistration' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/PostalRegistration']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
      <sf code="b" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
    </context>
  </df>

</rules>
