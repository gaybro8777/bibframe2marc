<?xml version='1.0'?>
<rules xmlns="http://www.loc.gov/bf2marc"
       xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
       xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
       xmlns:bf="http://id.loc.gov/ontologies/bibframe/"
       xmlns:bflc="http://id.loc.gov/ontologies/bflc/"
       xmlns:madsrdf="http://www.loc.gov/mads/rdf/v1#"
       xmlns:marc="http://www.loc.gov/MARC21/slim"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <df tag="010" repeatable="false">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[
        (local-name()='Lccn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Lccn']) and
        not(
          bf:status/bf:Status/rdfs:label[text()='invalid'] or
          bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
          bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'
        )]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <sf code="a" repeatable="false">
        <select xpath="rdf:value"/>
      </sf>
      <sf code="z">
        <select xpath="ancestor::bf:Instance/bf:identifiedBy/*[
            (local-name()='Lccn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Lccn']) and
            (
              bf:status/bf:Status/rdfs:label[text()='invalid'] or
              bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
              bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'
            )]/rdf:value"/>
      </sf>
    </context>
  </df>

  <df tag="015">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Nbn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Nbn']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
      <sf code="2" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
    </context>
  </df>

  <df tag="016">
    <context xpath="rdf:RDF/bf:Work/bf:adminMetadata/bf:AdminMetadata/bf:identifiedBy/bf:Local[
                      bf:source/bf:Source and
                      not(bf:source/bf:Source/rdfs:label='DLC')
                    ]">
      <ind1 default="7">
        <switch>
          <case test="bf:source/bf:Source/rdfs:label='OONL' or
                      bf:source/bf:Source/rdfs:label='Library and Archives Canada'"><text> </text></case>
        </switch>
      </ind1>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
      <sf code="2" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
    </context>
  </df>

  <df tag="017">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='CopyrightNumber' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/CopyrightNumber']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a"><select xpath="rdf:value"/></sf>
        </case>
      </switch>
      <sf code="b" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
      <sf code="d" repeatable="false"><select xpath="bf:date"/></sf>
      <sf code="i" repeatable="false"><select xpath="bf:note/bf:Note/rdfs:label"/></sf>
    </context>
  </df>

  <df tag="020">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Isbn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Isbn']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='invalid'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <sf code="z"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
          <sf code="c" repeatable="false"><select xpath="ancestor::bf:Instance/bf:acquisitionTerms"/></sf>
        </case>
      </switch>
      <sf code="q"><select xpath="bf:qualifier"/></sf>
    </context>
  </df>

  <df tag="022">
    <context xpath="rdf:RDF/bf:Instance/bf:identifiedBy/*[local-name()='Issn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Issn']] | rdf:RDF/bf:Work/bf:identifiedBy/*[local-name()='IssnL' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/IssnL']]">
      <ind1 default=" "/>
      <ind2 default=" "/>
      <switch>
        <case test="bf:status/bf:Status/rdfs:label[text()='canceled'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/invalid' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/invalid'">
          <switch>
            <case test="local-name()='Issn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Issn']">
              <sf code="z"><select xpath="rdf:value"/></sf>
            </case>
            <case test="local-name()='IssnL' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/IssnL']">
              <sf code="m"><select xpath="rdf:value"/></sf>
            </case>
          </switch>
        </case>
        <case test="bf:status/bf:Status/rdfs:label[text()='incorrect'] or
                    bf:status/@rdf:resource='http://id.loc.gov/vocabulary/mstatus/incorrect' or
                    bf:status/bf:Status/@rdf:about='http://id.loc.gov/vocabulary/mstatus/incorrect'">
          <sf code="y"><select xpath="rdf:value"/></sf>
        </case>
        <case test="default">
          <switch>
            <case test="local-name()='Issn' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Issn']">
              <sf code="a" repeatable="false"><select xpath="rdf:value"/></sf>
            </case>
            <case test="local-name()='IssnL' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/IssnL']">
              <sf code="l" repeatable="false"><select xpath="rdf:value"/></sf>
            </case>
          </switch>
        </case>
      </switch>
      <sf code="2" repeatable="false"><select xpath="bf:source/bf:Source/rdfs:label"/></sf>
    </context>
  </df>

</rules>
