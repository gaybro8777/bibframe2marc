<?xml version='1.0'?>
<rules xmlns="http://www.loc.gov/bf2marc"
       xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
       xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
       xmlns:bf="http://id.loc.gov/ontologies/bibframe/"
       xmlns:bflc="http://id.loc.gov/ontologies/bflc/"
       xmlns:madsrdf="http://www.loc.gov/mads/rdf/v1#"
       xmlns:marc="http://www.loc.gov/MARC21/slim"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <cf tag="001">
    <transform><xsl:value-of select="$vRecordId"/></transform>
  </cf>

  <switch>
    <case test="$vAdminMetadata/bf:source/bf:Source/bf:code">
      <cf tag="003">
        <transform>
          <xsl:value-of select="$vAdminMetadata/bf:source/bf:Source/bf:code"/>
        </transform>
      </cf>
    </case>
  </switch>

  <switch>
    <case test="$vAdminMetadata/bf:changeDate">
      <switch>
        <case test="$vAdminMetadata/bf:changeDate/@rdf:datatype='http://www.w3.org/2001/XMLSchema#dateTime'">
          <cf tag="005">
            <transform>
              <xsl:value-of select="concat(substring($vAdminMetadata/bf:changeDate,1,4),substring($vAdminMetadata/bf:changeDate,6,2),substring($vAdminMetadata/bf:changeDate,9,2),substring($vAdminMetadata/bf:changeDate,12,2),substring($vAdminMetadata/bf:changeDate,15,2),substring($vAdminMetadata/bf:changeDate,18,2),'.0')"/>
            </transform>
          </cf>
        </case>
        <case test="default">
          <transform>
            <xsl:message>Record <xsl:value-of select="$vRecordId"/>: Unprocessed bf:changeDate. Invalid datatype for 005.</xsl:message>
          </transform>
        </case>
      </switch>
    </case>
  </switch>

</rules>
